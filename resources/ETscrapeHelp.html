<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h1>EarthTrack Log Scraper</h1>

<p>The EarthTrack Log Scraper is relatively simple in that it just reads the contents of a log file from an EarthTrack Fleet Controller module,
and displays a sanitised version of trips included in the log file. The primary purpose of the application is as a diagnostic tool
for test personnel; so that they can avoid having to look through the log file which is not as easy to read.</p>

<h2>The application window</h2>
<p>The application consists of a single window divided into three panes. The left pane shows the parsed contents of all trips in the EarthTrack log file,
the right pane shows summary information for the currently selected trip,
and the bottom pane shows a speed plot for the currently selected trip.</p>
<br>
<img src="./appOpen.png" alt="Application start">

<h2>Opening a log file</h2>
<p>There are 2 ways to open a log file, i.e. either by using the application menu or by dragging a log file onto the application trip data pane.</p>
<h3>Opening a log file using the application menu</h3>
<p>Selecting the &#34;File &#47; Load log file&#34; menu item will launch a file browser from where the log file can be selected and opened.
Note that the application supports message logs (.csv) available at the server, as well as debuglog files downloaded from a controller.</p>
<br>
<img src="./logOpenMenu.png" alt="Log file open with menu">

<h3>Dragging and dropping a log file onto the application</h3>
<p>From a file explorer or browser drag and drop a log file onto the application trip data pane as illustrated in the following video.
The cursor will change to a drag cursor when over the application window if a file has been selected.
Note that if you attempt to drag more than one log file into the application, only the first file will be loaded.</p>
<br>
<video controls width="1064">
  <source src="./logOpenDrag.webm" type="video/webm">
</video>

<h3>Log file trip data organisation</h3>
<p>Once opened the trips included in the log file will be listed in the Trip Data pane on the left,
with the first trip being the currently selected trip.
Trips are identified with a Trip Number starting at 1 for the first trip in the log file, as well as the Trip Sign-on ID.
The Sign-on ID is include in SIGON event and ties all events in a trip together.</p>
<p>On the right hand side the Trip Summary pane shows summary information for the selected trip which at the start is trip 1.</p>
<p>The bottom pane shows a speed plot based on the speed reported in log event headers.
Also shown is a zone plot which is based on ZONECHANGE event information; in this case the zone speed shown is from application configuration
and not device configuration as this is not available in the logs for the trip. The theory being that for a given site zone speeds should
not change too often.</p>
<br>
<img src="./appLogLoaded.png" alt="Log file opened">
<p>Time on all views is presented in UTC or local time format depending on an application configuration parameter;
refer to the application configuration section below.
The current setting is displayed on the right side of the application status bar at the bottom of the application window.</p>

<h2>Navigating the Trip Data pane</h2>
<p>The Trip Data pane is structured as a tree, with trips as the trunk. A trip can be expanded to reveal the events in the trip,
and events can be expanded to show specific information for that event.
There are also &#34;expand all&#34; and &#34;collapse all&#34;; toolbar buttons to expand or collapse all trips, events, and event data items.</p>
<p>Navigation can be achieved using the mouse and clicking on the + or - (expand or collapse) branch points.
Alternatively, use the LEFT or RIGHT arrow keys to collapse or expand the current selected item.</p>
<p>The currently selected item, and therefore the currently selected trip can be set by selecting it with the mouse,
or by using the UP or DOWN arrow keys to navigate up or down the branch the item is on.
The HOME, END, PAGE_UP and PAGE_DOWN keys can also be used to select the first/last trips or to skip a page of items at a time.</p>
<p>The arrow buttons on either side of the trip identifier on the Trip Summary pane can also be used to navigate to the next or previous trip.</p>
<br>
<img src="./appNavTree.png" alt="Application navigation">
<p>The parsing of the log file detects &#34;Other&#34; event types, that while detected are not yet supported by the application.
Where not yet supported in this context means that no details are shown for these events.
Similarly INPUT and DEBUG events can also be shown in the Trip Data pane.</p>
<br>
<img src="./appNavOther.png" alt="Showing (Other) data">
<p>Showing Other, INPUT, or DEBUG events can be selected via application menu item checkboxes.
Note that these settings revert to configuration values the next time the application is started.
Note that even if configuration is set not to show INPUT events these events still contribute to the speed plot.</p>
<p>Note that the colour for the &#34;other&#34; and &#34;INPUT&#34; events can also be set in configuration.
Note also, that when other events are configured to be shown an extra entry is displayed in the Trip Summary pane.</p>
<br>
<img src="./appMenuShowHideEvents.png" alt="Show or hide event data menu">
<p>As seen in the previous figure there is an additional menu option to show out of trip events;
these are any events that occur after the TRIP event with the exception of the TRIPSUMMART event.</p>

<h2>Trip Data pane alert formatting</h2>
<p>The trip headers are highlighted to make the start of trips easier to find when all trips are expanded.
Events are normally highlighted in a blue (configurable) font, and event data is normally shown in black font.
The application does some simple checking of event data looking for edge conditions or potentially bad data,
and highlights this data. Where some event data has been highlighted the corresponding event and associated trip are highlighted in the same colour.
Note that hidden events to no contribute to the alert highlighting of the trip to which they belong.</p>
<br>
<img src="./appAlertData.png" alt="Alert data highlighted">
<p>In the example above a zero duration event has been detected for a zone overspeed event, which may or may not be an error.
The trip and event are also highlighted so that the presence of the alert is visible even if the trip tree is collapsed.</p>
<p>The application also performs some checking at the trip and event level, e.g. checking that trips are ended,
or that consecutive events have increasing time. For these types of alerts additional alert comments are added to an extra
column in the Trip Data pane as illustrated in the figure below.</p>
<br>
<img src="./appAlertEeventTrip.png" alt="Alert at trip and event level">
<p>Where alert comments apply to hidden events the highlighing of the assoicated trip is not performed.aion</p>
<p>In general alert comments are a good indication that something is awry with the log file or the controller itself.</p>

<h2>The Trip Summary pane</h2>
<p>The Trip Summary pane shows summary information for the currently selected trip,
noting that any item in the trip can be the currently selected item.</p>
<p>Apart from the trip start and end times, and trip duration, the summary information includes the total of different event types for that trip.
Non-zero totals are highlighted to make them more obvious. Refer to the previous image of Trip Data for a selected trip.</p>

<h2>The Speed Plot pane</h2>
<p>The Speed Plot pane shows the plot of vehicle speed for the currently selected trip, and similarly, a zone change plot.</p>
<p>The data for the vehicle speed plot comes from log event header information for events during the trip.
Note that the vehicle speed is displayed in the speed plot even if the events are configured not to be shown in the Trip Data pane.</p>
<p>It is important to note that while the vehicle speed plot shows a line, only the plot markers come faionion
<br>
<img src="./speedPlot.png" alt="Vehicle speed plot">
<p>The plots in the Speed Plot pane use the Python <a href="https://matplotlib.org/">https://matplotlib.org/</a> library.
The standard matplotlib toolbar is displayed at the top of the Speed Plot pane, and can be used to perform standard functions,
such as panning or zooming the plot, or to save an image of the plot.</p>
<p>The colours used in the plot can be set in the application configuration.</p>

<h2>Trip data exporting</h2>
<p>The application allows exporting of trip events for the currently selected trip or all trips in the log file.
The export options are available from the application menu if a log file is loaded.
Once selected a file selection dialog is presented allowing the user to select the file to export to.</p>
<br>
<img src="./exportMenu.png" alt="Export menu">
<p>Exporting is in plain text and mostly reflects the data presented on the Trip Data and Trip Summary panes;
trip speed data is not exported other than as part of event information.</p>
<p>If exporting data for all trips is selected, all trips are exported to a single file.</p>
<p>For each trip the export consists of a header that includes the trip time and sign-on ID,
followed up a summary table of events in the trip, followed by each of the events in the trip.
Note that all events are included in the export regardless of whether or not they are currently shown.</p>
<br>
<img src="./exportFile.png" alt="Export file structure">
   
<h2>Application configuration</h2>
<p>The application has a number of configurable parameters; these are held in Json format in a file called etscrape.json.
The configuration parameters include parameters for logging and colours for formatting Trip Data and Speed Plot displays.
Configuration is also included for the naming of INPUT event channels.</p>
<p>If the configuration file is not found a default file will be created.
Similarly, if the version of the configuration file is less than the required version the file will be overwritten with default values when the application is started.</p>
<br>
<img src="./appJsonConfig.png" alt="Application configuration data">
<p>Configuration values can be changed directly in the Json configuration file, although care should be taken if doing so.</p>
<p>User Interface preferences can be changed from within the application, and can be saved to the application configuration file.
Selecting the &#34;Edit &#47; Preferences&#34; menu item will launch a dialog where all UI parameters can be changed.</p>
<br>
<img src="./editPreferences.png" alt="Editing user preferences">
<p>Editing numeric fields will limit entry to an allowable range.
To change a configuration item colour, select the adjacent shaded button which will present a colour selection dialog
from which a colour can be selected.</p>
<p>Selecting &#34;Save&#34; on the Edit Preferences dialog will save all preferences to the application configuration file.
Note that all but the logging preferences (other than than the logging level) will have immediate effect.</p>
        
<h2>Application logging</h2>
<p>The application uses the standard Python logging library. Configuration parameters are used to control the number of log files used
and the maximum size of each log file. The main log file is called etscrape.log, and older log files are suffixed with .1, .2, .3 etc.</p>
<p>The debug level applies as per the Python standard,
refer to <a href="https://docs.python.org/3/library/logging.html">https://docs.python.org/3/library/logging.html</a></p>
<br>
<img src="./appLogFormat.png" alt="Log file format">

</body>
</html>
