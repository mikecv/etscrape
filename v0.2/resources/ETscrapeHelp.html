<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h1>EarthTrack Log Scraper</h1>

<p>The EarthTrack Log Scraper is relatively simple in that it just reads the contents of a log file from an EarthTrack Fleet Controller module,
and displays a sanitised version of trips included in the log file. The primary purpose of the application is as a diagnostic tool
for test personnel; so that they can avoid having to look through the log file which is not as easy to read.</p>

<h2>The application window</h2>
<p>The application consists of a single window divided into three panes. The left pane shows the parsed contents of all trips in the EarthTrack log file,
the right pane shows summary information for the currently selected trip,
and the bottom pane shows speed information for the currently selected trip.</p>
<br>
<img src="./appOpen.png" alt="Application start">

<h2>Opening a log file</h2>
<p>Selecting the &#34;File &#47; Load log file&#34; menu item will launch a file browser from where the log file can be selected and opened.
Note that the application supports message logs (.csv) available at the server, as well as debuglog files download from a controller.</p>
<p>Once opened the trips included in the log file will be listed in the Trip Data pane on the left,
with the first trip being the currently selected trip.</p>
On the right hand side the Trip Summary pane shows summary information for the selected trip which at the start is trip 1.
<p>The bottom pane shows a speed plot based on the speed reported in log event headers.
Also shown is a zone plot which is based on ZONECHANGE event information; in this case the zone speed shown is from application configuration
and not device configuration as this is not available in the logs for the trip. The theory being that for a given site zone speeds should
not change too often.</p>
<br>
<img src="./appLogLoaded.png" alt="Log file opened">

<h2>Navigating the Trip Data pane</h2>
<p>The Trip Data pane is structured as a tree, with trips as the trunk. A trip can be expanded to reveal the events in the trip,
and events can be expanded to show specific information for that event.
There are also &#34;expand all&#34; and &#34;collapse all&#34;; toolbar buttons to expand or collapse all trips, events, and event data items.</p>
<p>Navigation can be achieved using the mouse and clicking on the + or - (expand or collapse) branch points.
Alternatively, use the LEFT or RIGHT arrow keys to collapse or expand the current selected item.</p>
<p>The currently selected item, and therefore the currently selected trip can be set by selecting it with the mouse,
or by using the UP or DOWN arrow keys to navigate up or down the branch the item is on.
The HOME, END, PAGE_UP and PAGE_DOWN keys can also be used to select the first/last trips or to skip a page of items at a time.</p>
<br>
<img src="./appNavTree.png" alt="Application navigation">

<p>The parsing of the log file detects other &#34;event types&#34;, that while detected are not yet supported by the application.
Where not yet supported in this context means that no details are shown for these events.
There is a configuration option &#34;ShowOtherEvents&#34; (see the section on &#34;Application configuration&#34; below)
to enable the display of these other events. Setting this parameter to 1 will show the other events as illustrated below.</p>
<p>Similar to &#34;event types&#34; described above, INPUT events can also be shown in the Trip Data pane,
and the display of these events is also governed by application configuration values (see below).
Note that even if configuration is set not to show INPUT events these events still contribute to the speed plot.</p>
<br>
<img src="./appNavOther.png" alt="Showing (Other) data">
<p>Note that the colour for the &#34;other&#34; and &#34;INPUT&#34; events can also be set in configration.
Note also, that when other events are configured to be shown an extra entry is displayed in the Trip Summary pane.</p>
<p>While the display of &#34;other&#34; and &#34;INPUT&#34; events is held in application configuration,
they can also be displayed or hidden from the &#34;View&#34; menu, noting that any changes only apply to the current session,
i.e. the application configuration is not changed.</p>
<br>
<img src="./appMenuShowHideEvents.png" alt="Show or hide event data menu">
<p>As seen in the previous figure there is an additional menu option to show out of trip events;
these are any events that occur after the TRIP event with the exception of the TRIPSUMMART event.</p>
	
<h2>Trip Data pane alert formatting</h2>
<p>The trip headers are highlighted to make the start of trips easier to find when all trips are expanded.
Events are normally highlighted in a blue font, and event data is normally shown in black font.
The application does some simple checking of event data looking for edge conditions or potentially bad data,
and highlights this data. Where some event data has been highlighted the corresponding event and associated trip are highlighted in the same colour.</p>
<br>
<img src="./appAlertData.png" alt="Alert data highlighted">
<p>In the example above a zero duration event has been detected for a zone overspeed event, which may or may not be an error.
The trip and event are also highlighted so that the presence of the alert is visible even if the trip tree is collapsed.</p>
<p>The application also performs some checking at the trip and event level, e.g. checking that trips are ended,
or that consecutive events have increasing time. For these types of alerts addtional alert comments are added to an extra
column in the Trip Data pane as illustrated in the figure below.</p>
<br>
<img src="./appAlertEeventTrip.png" alt="Alert at trip and event level">
<p>Where alert comments apply to hidden events the highlighing of the assoicated trip is not performed.</p>
<p>In general alert comments are a good indication that something is awry with the log file or the controller itself.</p>

<h2>The Trip Summary pane</h2>
<p>The Trip Summary pane shows summary information for the currently selected trip,
noting that any item in the trip can be the currently selected item.</p>
<p>Apart from the trip start and end times, and trip duration, the summary information includes the total of different event types for that trip.
Non-zero totals are highlighted to make them more obvious. Refer to the previous image of Trip Data for a selected trip.</p>

<h2>The Speed Plot pane</h2>
<p>The Speed Plot pane shows the plot of vehicle speed for the currently selected trip, and similarly, a zone change plot.</p>
<p>The data for the vehicle speed plot comes from log event header information for events during the trip.
Note that vehicle speed is displayed in the speed plot even if the events are configured not to be shown in the Trip Data pane.</p>
<p>It is important to note that while the vehicle speed plot shows a line, only the plot markers come from log events;
the lines connecting the markers simply show the sequence of events. The speed plots are good for showing problems such as
event time out of sequence or speed values not in the expected range.</p>
<p>The zone change step function comes from any ZONECHANGE events during the trip; if there are no ZONECHANGE events during the trip no plot is shown.
The slow and fast zone speeds are <b>not</b> taken from the log file, as not necessarily available;
instead values are stored in application configuration. For these reason the zone change plot is predominantly an indication of vehicle
position and zone speed limits.</p>
<br>
<img src="./speedPlot.png" alt="Vehicle speed plot">
<p>The plots in the Speed Plot pane use the Python <a href="https://matplotlib.org/">https://matplotlib.org/</a> library.
The standard matplotlib toolbar is displayed at the top of the Speed Plot pane, and can be used to perform standard functions,
such as panning or zooming the plot, or to save an image of the plot.</p>
<p>The colours used in the plot can be set in the application configuration.</p>

<h2>Application configuration</h2>
<p>The application has a number of configurable parameters; these are held in Json format in a file called etscrape.json.
The configuration parameters include parameters for logging and colours for formatting Trip Data and Speed Plot displays.
Configuration is also included for the naming of INPUT event channels.</p>
<p>If the configuration file is not found a default file will be created.
Similarly, if the version of the configration file is less than the required version the file will be overwritten with default values.</p>
<br>
<img src="./appJsonConfig.png" alt="Application configuration data">
		
<h2>Application logging</h2>
<p>The application uses the standard Python logging library. Configuration parameters are used to control the number of log files used
and the maximum size of each log file. The main log file is called etscrape.log, and older log files are suffixed with .1, .2, .3 etc.</p>
<p>The configuration parameter "DebugLevel" specifies the logging level as per the Python standard,
refer to <a href="https://docs.python.org/3/library/logging.html">https://docs.python.org/3/library/logging.html</a></p>
<br>
<img src="./appLogFormat.png" alt="Log file format">

</body>
</html>
